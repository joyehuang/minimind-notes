# Repository Traffic Statistics

本目录记录了 minimind 仓库的长期访问统计数据，突破 GitHub 官方 Insights 仅保留 14 天数据的限制。

## 📊 数据文件

### `traffic-history.json`

包含完整的历史访问记录，结构如下：

```json
{
  "clones": [
    {
      "timestamp": "2025-11-24T00:00:00Z",
      "count": 15,
      "uniques": 8
    }
  ],
  "views": [
    {
      "timestamp": "2025-11-24T00:00:00Z",
      "count": 234,
      "uniques": 123
    }
  ],
  "summary": {
    "total_clones": 1234,
    "total_unique_clones": 567,
    "total_views": 5678,
    "total_unique_views": 2345
  },
  "last_updated": "2025-11-24T08:00:00Z"
}
```

**字段说明**：
- `timestamp`: 日期（UTC 时间，每天一条记录）
- `count`: 当天的总访问次数
- `uniques`: 当天的独立访问者数量
- `summary`: 累计统计数据
- `last_updated`: 最后更新时间

## 🤖 自动化工作流

### GitHub Actions Workflow

工作流配置文件：`.github/workflows/record-traffic.yml`

**运行时间**：
- 自动运行：每天 UTC 0:00（北京时间 8:00）
- 手动触发：在 Actions 页面点击 "Run workflow"

**工作原理**：
1. 调用 GitHub Traffic API 获取最近 14 天的数据
2. 与本地历史数据合并（自动去重）
3. 更新统计汇总
4. 提交数据文件到仓库

**去重机制**：
- 基于 `timestamp` 字段去重
- 相同日期的数据只保留最早记录
- 确保历史数据不会重复

## 🚀 使用方法

### 查看统计数据

**方式 1：直接查看 JSON 文件**
```bash
cat .github/traffic-data/traffic-history.json
```

**方式 2：使用 Python 脚本分析**
```python
import json
from datetime import datetime

with open('.github/traffic-data/traffic-history.json', 'r') as f:
    data = json.load(f)

print(f"总克隆次数: {data['summary']['total_clones']}")
print(f"独立克隆用户: {data['summary']['total_unique_clones']}")
print(f"总浏览次数: {data['summary']['total_views']}")
print(f"独立浏览用户: {data['summary']['total_unique_views']}")

# 查看最近 7 天的数据
recent_clones = data['clones'][-7:]
for record in recent_clones:
    date = datetime.fromisoformat(record['timestamp'].replace('Z', '+00:00'))
    print(f"{date.date()}: {record['count']} clones ({record['uniques']} unique)")
```

**方式 3：在 GitHub Actions 页面查看**
- 进入仓库的 **Actions** 页面
- 选择 **Record Repository Traffic** workflow
- 查看最近一次运行的 Summary

### 手动触发更新

1. 进入仓库的 **Actions** 页面
2. 选择左侧的 **Record Repository Traffic**
3. 点击右上角 **Run workflow** 按钮
4. 选择分支（通常是 `master`）
5. 点击 **Run workflow** 确认

### 数据可视化（可选）

你可以创建自定义脚本来可视化数据：

```python
import json
import matplotlib.pyplot as plt
from datetime import datetime

with open('.github/traffic-data/traffic-history.json', 'r') as f:
    data = json.load(f)

# 提取日期和克隆数
dates = [datetime.fromisoformat(c['timestamp'].replace('Z', '+00:00')) for c in data['clones']]
clones = [c['count'] for c in data['clones']]

# 绘制趋势图
plt.figure(figsize=(12, 6))
plt.plot(dates, clones, marker='o')
plt.title('Repository Clones Over Time')
plt.xlabel('Date')
plt.ylabel('Daily Clones')
plt.xticks(rotation=45)
plt.tight_layout()
plt.savefig('clones_trend.png')
```

## 📈 数据指标说明

### Clones（克隆数）
- **count**: 当天的 `git clone` 操作总次数
- **uniques**: 当天执行克隆操作的独立用户数
- 包含所有协议（HTTPS、SSH、GitHub CLI）

### Views（浏览数）
- **count**: 当天的仓库页面访问总次数
- **uniques**: 当天访问仓库页面的独立用户数
- 包含所有仓库相关页面（主页、文件、commits 等）

### 数据保留
- GitHub API 只提供最近 14 天的数据
- 本系统通过每日采集实现**无限期数据保留**
- 建议每周至少检查一次 workflow 是否正常运行

## 🔧 故障排查

### Workflow 没有运行
1. 检查 Actions 是否在仓库设置中启用
2. 检查仓库的 **Settings > Actions > General**
3. 确保 Workflow 权限设置为 "Read and write permissions"

### 数据没有更新
1. 查看最近一次 workflow 运行日志
2. 检查是否有新的访问数据（可能当天没有新访问）
3. 手动触发 workflow 测试

### API 限流
- GitHub Actions 使用 `GITHUB_TOKEN` 自动认证
- 每小时 1000 次 API 调用限制（对 Actions 足够）
- 如遇到限流，workflow 会在下次运行时自动重试

## 📝 注意事项

1. **数据隐私**：
   - 本数据是公开的统计信息，不包含个人身份信息
   - 只记录访问次数和独立访问者数量

2. **数据准确性**：
   - 依赖 GitHub Traffic API，数据可能有 1-2 小时延迟
   - 数据去重基于 UTC 日期

3. **仓库大小**：
   - JSON 文件会随时间增长，但增长速度很慢
   - 预计每年增加约 50-100KB

4. **自定义调整**：
   - 修改 `record-traffic.yml` 中的 cron 表达式可调整运行频率
   - 建议至少每周运行一次，以避免数据丢失

## 📊 当前统计

查看最新统计：点击 Actions 页面的最新 workflow 运行结果

---

**Last Updated**: Auto-generated by GitHub Actions
**Data Source**: GitHub Traffic API
**Retention**: Unlimited (vs. GitHub's 14-day limit)
