#!/bin/bash

# ä¸€é”®è¿è¡Œæ‰€æœ‰å®éªŒ
# ç”¨æ³•: bash run_all.sh

echo "======================================================================"
echo "ğŸš€ è¿è¡Œ Normalization æ¨¡å—çš„æ‰€æœ‰å®éªŒ"
echo "======================================================================"
echo ""

# æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•
if [ ! -f "exp1_gradient_vanishing.py" ]; then
    echo "âŒ é”™è¯¯ï¼šè¯·åœ¨ experiments/ ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬"
    echo "   cd modules/01-foundation/01-normalization/experiments"
    exit 1
fi

# åˆ›å»ºç»“æœç›®å½•
mkdir -p results

# å®éªŒ 1
echo "----------------------------------------------------------------------"
echo "ğŸ”¬ å®éªŒ 1: æ¢¯åº¦æ¶ˆå¤±å¯è§†åŒ–"
echo "----------------------------------------------------------------------"
python exp1_gradient_vanishing.py
if [ $? -eq 0 ]; then
    echo "âœ… å®éªŒ 1 å®Œæˆ"
else
    echo "âŒ å®éªŒ 1 å¤±è´¥"
    exit 1
fi
echo ""

# å®éªŒ 2
echo "----------------------------------------------------------------------"
echo "ğŸ”¬ å®éªŒ 2: å››ç§é…ç½®å¯¹æ¯”"
echo "----------------------------------------------------------------------"
python exp2_norm_comparison.py --quick
if [ $? -eq 0 ]; then
    echo "âœ… å®éªŒ 2 å®Œæˆ"
else
    echo "âŒ å®éªŒ 2 å¤±è´¥"
    exit 1
fi
echo ""

# å®éªŒ 2-Extraï¼ˆè¡¥å……å®éªŒï¼Œæ–‡ä»¶åï¼šexp2_layernorm_vs_rmsnorm.pyï¼‰
# è¯´æ˜ï¼šæœ¬å®éªŒä¸“æ³¨äº LayerNorm å’Œ RMSNorm çš„ç›´æ¥å¯¹æ¯”ï¼Œæ˜¯å¯¹å®éªŒ 2 çš„è¡¥å……
echo "----------------------------------------------------------------------"
echo "ğŸ”¬ å®éªŒ 2-Extra: LayerNorm vs RMSNorm å¯¹æ¯”ï¼ˆè¡¥å……ï¼‰"
echo "----------------------------------------------------------------------"
python exp2_layernorm_vs_rmsnorm.py
if [ $? -eq 0 ]; then
    echo "âœ… å®éªŒ 2-Extra å®Œæˆ"
else
    echo "âŒ å®éªŒ 2-Extra å¤±è´¥"
    exit 1
fi
echo ""

# å®éªŒ 3
echo "----------------------------------------------------------------------"
echo "ğŸ”¬ å®éªŒ 3: Pre-LN vs Post-LN æ·±åº¦å¯¹æ¯”"
echo "----------------------------------------------------------------------"
python exp3_prenorm_vs_postnorm.py --quick
if [ $? -eq 0 ]; then
    echo "âœ… å®éªŒ 3 å®Œæˆ"
else
    echo "âŒ å®éªŒ 3 å¤±è´¥"
    exit 1
fi
echo ""

# æ€»ç»“
echo "======================================================================"
echo "âœ… æ‰€æœ‰å®éªŒå®Œæˆï¼"
echo "======================================================================"
echo ""
echo "ğŸ“Š æŸ¥çœ‹ç»“æœ:"
echo "   ls results/"
echo "   - gradient_vanishing.png           (å®éªŒ 1)"
echo "   - norm_comparison.png              (å®éªŒ 2)"
echo "   - layernorm_vs_rmsnorm.png         (å®éªŒ 2-Extra)"
echo "   - prenorm_vs_postnorm.png          (å®éªŒ 3)"
echo ""
echo "ğŸ“– ä¸‹ä¸€æ­¥:"
echo "   1. æŸ¥çœ‹ç”Ÿæˆçš„å›¾è¡¨"
echo "   2. é˜…è¯» ../teaching.md ç†è§£ç†è®º"
echo "   3. å®Œæˆ ../quiz.md è‡ªæµ‹é¢˜"
echo ""
